{% extends 'dashboard/base.html' %}
{% load static %}
{% block body %}
<div class="content-wrapper">
  <div class="page-header">
    <h3 class="page-title">Course listed</h3>
  </div>
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <div class="container text-center pt-5">
            <h4 class="mb-3 mt-5">Start up your Quiz Practice today</h4>
            <p class="w-75 mx-auto mb-5">
              Choose a plan that suits you the best. If you are not fully
              satisfied, we offer 30-day money-back guarantee no questions
              asked!!
            </p>

            <div class="row pricing-table">
              <div class="col-md-3 grid-margin stretch-card pricing-card">
                <div class="card border-primary border pricing-card-body">
                  <div class="text-center pricing-card-head">
                    <h3>Free</h3>
                    <p>Basic plan</p>
                    <h1 class="font-weight-normal mb-4">$0.00</h1>
                  </div>
                  <ul class="list-unstyled plan-features"></ul>
                  <div class="wrapper">
                    <a href="#" class="btn btn-outline-primary btn-block">Current Plan</a>
                  </div>
                  <p class="mt-3 mb-0 plan-cost text-gray">Free</p>
                </div>
              </div>
              <div class="col-md-3 grid-margin stretch-card pricing-card">
                <div class="card border border-success pricing-card-body">
                  <div class="text-center pricing-card-head">
                    <h3 class="text-success">Registered Nurse</h3>
                    <p>Paid plan</p>
                    <h1 class="font-weight-normal mb-4">₦1,000</h1>
                  </div>
                  <ul class="list-unstyled plan-features"></ul>
                  <div class="wrapper">
                    <button class="common_btn btn btn-success btn-block" onclick="payWithPaystack(30); return false;">Pay</button>
                    <p class="mt-3 mb-0 plan-cost text-success">or purchase now</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3 grid-margin stretch-card pricing-card">
                <div class="card border border-success pricing-card-body">
                  <div class="text-center pricing-card-head">
                    <h3 class="text-success">Registered Midwifery</h3>
                    <p>Paid plan</p>
                    <h1 class="font-weight-normal mb-4">₦1,000</h1>
                  </div>
                  <ul class="list-unstyled plan-features"></ul>
                  <div class="wrapper">
                    <button class="common_btn btn btn-success btn-block" onclick="payWithPaystack(30); return false;">Pay</button>
                    <p class="mt-3 mb-0 plan-cost text-success">or purchase now</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3 grid-margin stretch-card pricing-card">
                <div class="card border border-success pricing-card-body">
                  <div class="text-center pricing-card-head">
                    <h3 class="text-success">Psychiatric Nurse</h3>
                    <p>Paid plan</p>
                    <h1 class="font-weight-normal mb-4">₦1,000</h1>
                  </div>
                  <ul class="list-unstyled plan-features"></ul>
                  <div class="wrapper">
                    <button class="common_btn btn btn-success btn-block" onclick="payWithPaystack(30); return false;">Pay</button>
                    <p class="mt-3 mb-0 plan-cost text-success">or purchase now</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
  function payWithPaystack(days) {
    var firstName = "{{ user.first_name }}";
    var lastName = "{{ user.last_name }}";
    var email = "{{ user.email }}";

    var amount = days === 30 ? "100000" : "1200000"; 

    const paystack = new PaystackPop();
    paystack.newTransaction({
    
      key: 'pk_live_fa8abc05ebf50e6c88e081387d75de2abc9b4749',
      email: email,
      amount: amount,
     
      onSuccess: (transaction) => { 
        console.log('Paystack response:', transaction);
      
        if (response.status === "success") {
          console.log('Payment successful. Redirecting...');
          var subscriptionUrl = "{% url 'quiz:create_subscription' days='30' %}".replace('30', days); // Replace '30' with dynamic days if needed
          window.location.href = subscriptionUrl;
        } else {
          window.location.href = "{{ failure_url }}";
        }
      },
      onCancel: () => {
        window.location.href = "{{ failure_url }}";
      }
    });
    handler.openIframe();
  }
</script>
{% endblock body %}
